<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" href="../bootstrap/bootstrap-table/dist/bootstrap-table.css">
		<link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
		<script type="text/javascript" src="../js/jquery-1.11.0.min.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../bootstrap/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../bootstrap/js/bootstrap.min.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../bootstrap/bootstrap-table/dist/bootstrap-table.min.js" charset="UTF-8"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
		<script src="../js/Chart.js"></script>
		<script src="../js/bootstart_chart.js"></script>
		<!-- 	 <script src="https://cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script> -->
	</head>
	<body>

		<div class="btn-group" role="group" aria-label="..." style="padding:10px 0px 0px 15px;">
			<input id="search-beginTime" class="form-control" size="16" type="text" value="">
			<input id="search-endTime" class="form-control" size="16" type="text" value="">
			<button id="sendtable" type="button" class="btn btn-danger" onclick="sendgetstatus()">搜索</button>
		</div>

		<table id="table"></table>
		<div>
			<canvas id="line-chart" height="450px" width="800px"></canvas>

		</div>

		<script>
			function sendgetstatus() {
				$("#table").bootstrapTable("refresh");
				$.ajax({
					url: "http://localhost:8098/status/get_statistical_data",
					data: {
						beginTime: $("#search-beginTime").val(),
						endTime: $("#search-endTime").val()
					},
					success: function(result) {
						console.log(result);
						var x_labels = []
						var y_labels = []
						var rows = result.rows;

						for (i = 0; i < rows.length; i++) {
							x_labels.push(rows[i].time);
							y_labels.push(rows[i].egData[0])
						}
						var param = {};
						// rows.each(function() {
						// 	var id = this.id;
						// 	var name = this.name;
						// 	var val = $("#" + id).val();
						// 	//动态添加属性、赋值
						// 	eval("param." + name + "=" + val)
						// }

						init_chart(x_labels, y_labels);

					}
				});

			}



			$("#table").bootstrapTable({
				url: "http://localhost:8098/status/get_statistical_data", //请求后台的URL（*）
				method: 'GET', //请求方式（*）
				//toolbar: '#toolbar',              //工具按钮用哪个容器
				striped: true, //是否显示行间隔色
				cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
				pagination: true, //是否显示分页（*）
				sortable: true, //是否启用排序
				sortOrder: "asc", //排序方式
				sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
				pageNumber: 1, //初始化加载第一页，默认第一页,并记录
				pageSize: 10, //每页的记录行数（*）
				pageList: [50, 100], //可供选择的每页的行数（*）
				search: false, //是否显示表格搜索
				strictSearch: true,
				showColumns: true, //是否显示所有的列（选择显示的列）
				showRefresh: true, //是否显示刷新按钮
				minimumCountColumns: 2, //最少允许的列数
				clickToSelect: true, //是否启用点击选中行
				//height: 500,                      //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
				uniqueId: "ID", //每一行的唯一标识，一般为主键列
				showToggle: true, //是否显示详细视图和列表视图的切换按钮
				cardView: false, //是否显示详细视图
				detailView: false, //是否显示父子表
				//得到查询的参数
				queryParams: function(params) {
					//这里的键的名字和控制器的变量名必须一致，这边改动，控制器也需要改成一样的
					var temp = {
						rows: params.limit, //页面大小
						page: (params.offset / params.limit) + 1, //页码
						sort: params.sort, //排序列名  
						sortOrder: params.order, //排位命令（desc，asc） 
						beginTime: $("#search-beginTime").val(),
						endTime: $("#search-endTime").val()
					};
					return temp;
				},

				columns: [{
					checkbox: true,
					visible: true //是否显示复选框  
				}, {
					field: 'time',
					title: '日期',
					sortable: true
				}, {
					field: 'week',
					title: '星期',
					sortable: true
				}, {
					field: 'newAccUser',
					title: '新增访问人数',
					sortable: true
				}, {
					field: 'accCount',
					title: '历史访问人数',
					sortable: true
				}, {
					field: 'newVipUserNum',
					title: '当日新开会员人数',
					sortable: true
				}, {
					field: 'vipUserNum',
					title: 'VIP总数量',
					sortable: true
				}, {
					field: 'playTimeCount',
					title: '播放总舒畅',
					sortable: true
				}, {
					field: 'vipRatio',
					title: 'vip转换率',
					sortable: true
				}],
			});
		</script>
	</body>
</html>
